<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Team CRM</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="services.js"></script> 
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#0f172a',
                            main: '#3b82f6',
                            accent: '#ef4444'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const SESSION_KEY = 'homeTeam_session_v6';
        const API_URL = 'http://localhost:3000/api';
        const AUTO_LOGOUT_TIME = 120 * 60 * 1000; 
        const hashPass = (p) => `hash_${p}`;
		// --- –ª–æ–≥—ñ–Ω ---
      const LoginScreen = ({ onLogin, users }) => {
    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏–≤ –¥–∞–Ω—ñ –≤–ª–∞—Å–Ω–æ—Ä—É—á
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState(''); 
    const [error, setError] = useState('');

    const handleSubmit = (e) => {
        e.preventDefault();
        const user = users.find(u => {
            const isEmailMatch = u.email === email;
            const isPasswordMatch = u.passwordHash === hashPass(password) || u.passwordHash === password;
            return isEmailMatch && isPasswordMatch;
        });

        if (user) {
            onLogin(user);
        } else {
            setError("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –¥–æ—Å—Ç—É–ø—É");
        }
    };

    return (
        <div className="min-h-screen flex flex-col items-center justify-center bg-brand-dark p-6 grid-bg relative overflow-hidden">
            {/* –§–æ–Ω–æ–≤–µ —Å—è–π–≤–æ (–µ—Ñ–µ–∫—Ç —Ä—ñ–¥–∫–æ–≥–æ —Å–∫–ª–∞) */}
            <div className="absolute top-1/4 left-1/2 -translate-x-1/2 w-full max-w-[600px] h-[300px] bg-brand-main/20 blur-[100px] rounded-full -z-10 animate-pulse-slow"></div>
<div className="glass p-8 lg:p-12 rounded-[50px] w-full max-w-md fade-in relative overflow-hidden shadow-2xl border border-white/10">
    <a href="site.html" className="absolute top-8 left-8 text-white/30 hover:text-white transition-all flex items-center gap-2 text-[9px] font-black uppercase tracking-[0.2em] group">
        <svg className="w-4 h-4 transform group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        –ù–∞–∑–∞–¥
    </a>

    <div className="text-center mt-6">
        <div className="mb-3 inline-block p-5 bg-[#0566C7] rounded-[28px] shadow-lg shadow-blue-900/40 transform transition-transform hover:scale-105">
            <svg className="w-7 h-7 text-white" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 10.8L12 3l9 7.8v1.7c0 .4-.4.6-.8.4L12 6.6 3.8 12.9c-.4.2-.8 0-.8-.4v-1.7z"/>
                <path d="M5 11.5V21a1 1 0 001 1h4v-5a2 2 0 014 0v5h4a1 1 0 001-1v-9.5l-7-4.9-7 4.9z"/>
            </svg>
        </div>
    
        <div className="flex flex-col items-center select-none mb-6" style={{ fontFamily: "'Libre Franklin', sans-serif" }}>
            <h2 className="text-2xl lg:text-3xl font-bold tracking-tighter uppercase flex items-center justify-center leading-none">
                <span className="italic text-white">Home</span>
                <span className="italic ml-2 text-[#0566C7]">Team</span>
            </h2>
            <span className="text-[10px] font-black text-white/40 tracking-[0.4em] uppercase mt-1.5 whitespace-nowrap">
                Service Platform
            </span>
        </div>
        <p className="text-white font-bold mb-6 uppercase text-[15px] tracking-[0.3em]">–í—Ö—ñ–¥</p>
        
        <form onSubmit={handleSubmit} className="space-y-4 text-left">
            {error && (
                <div className="bg-red-500/10 text-red-400 p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest border border-red-500/20 animate-bounce">
                    {error}
                </div>
            )}
            
            <div className="relative group">
                <input 
                    type="email" 
                    value={email} 
                    onChange={e => setEmail(e.target.value)}
                    className="w-full bg-white/5 border border-white/5 p-5 rounded-2xl focus:border-[#0566C7] focus:bg-white/10 outline-none transition-all font-bold text-white placeholder-white/20 text-sm"
                    placeholder="E-MAIL" 
                    required 
                />
            </div>
            
            <div className="relative group">
                <input 
                    type="password" 
                    value={password} 
                    onChange={e => setPassword(e.target.value)}
                    className="w-full bg-white/5 border border-white/5 p-5 rounded-2xl focus:border-[#0566C7] focus:bg-white/10 outline-none transition-all font-bold text-white placeholder-white/20 text-sm"
                    placeholder="–ü–ê–†–û–õ–¨" 
                    required 
                />
            </div>
            
            <button className="w-full bg-[#0566C7] text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-900/40 hover:bg-blue-600 transition-all active:scale-95 text-[11px] uppercase tracking-[0.2em] mt-4">
                –ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è
            </button>
        </form>
    </div>
</div>

            {/* –§—É—Ç–µ—Ä –ª–æ–≥—ñ–Ω-—Å—Ç–æ—Ä—ñ–Ω–∫–∏ */}
            <footer className="mt-16 text-center select-none">
                <p className="text-[10px] font-black italic text-white/90 uppercase tracking-tighter">
                    Developed for <span className="text-white">Ukr Zhytlo Service</span>
                </p>
                <div className="mt-8 pt-6 border-t border-white/20 flex justify-center gap-8 text-[7px] font-black uppercase tracking-widest text-white/80">
                    <span>&copy; 2026 Home Team</span>
                </div>
            </footer>
        </div>
    );
};

const InventoryView = ({ inventory, setInventory, addLog }) => {
    const [newItem, setNewItem] = React.useState({
        item: '',
        model: '',
        quantity: 0,
        unit: '—à—Ç',
        category: '–Ü–Ω—à–µ',
        minLimit: 5 // –ü–æ—Ä—ñ–≥ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ª–∏—à–∫—É
    });

    const categories = ['–ï–ª–µ–∫—Ç—Ä–∏–∫–∞', '–°–∞–Ω—Ç–µ—Ö–Ω—ñ–∫–∞', '–ö–ª—ñ–Ω—ñ–Ω–≥', '–°–∞–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ', '–û—Ñ—ñ—Å–Ω–µ –ø—Ä–∏–ª–∞–¥–¥—è', '–Ü–Ω—à–µ'];

    const addItem = () => {
        if (!newItem.item || !newItem.model) {
            alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –º–æ–¥–µ–ª—å!");
            return;
        }

        const updated = [
            ...inventory,
            {
                ...newItem,
                id: Date.now(),
                quantity: Math.max(0, parseInt(newItem.quantity) || 0),
                minLimit: Math.max(1, parseInt(newItem.minLimit) || 5)
            },
        ];
        setInventory(updated);
        addLog('–°–∫–ª–∞–¥', `–î–æ–¥–∞–Ω–æ: ${newItem.category} - ${newItem.item} (${newItem.model})`);
        setNewItem({ item: '', model: '', quantity: 0, unit: '—à—Ç', category: '–Ü–Ω—à–µ', minLimit: 5 });
    };

    const updateQty = (id, val) => {
        const updated = inventory.map(i =>
            i.id === id ? { ...i, quantity: Math.max(0, parseInt(val) || 0) } : i
        );
        setInventory(updated);
    };

    const removeItem = (id, name) => {
        if (confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ ${name}?`)) {
            setInventory(inventory.filter(i => i.id !== id));
            addLog('–°–∫–ª–∞–¥', `–í–∏–¥–∞–ª–µ–Ω–æ –º–∞—Ç–µ—Ä—ñ–∞–ª: ${name}`);
        }
    };

    // –§—É–Ω–∫—Ü—ñ—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∑–∞–ª–∏—à–∫—É
    const getStockStatus = (qty, min) => {
        if (qty <= 0) return { label: '–í—ñ–¥—Å—É—Ç–Ω—å–æ', color: 'bg-red-500', text: 'text-red-600' };
        if (qty < min) return { label: '–ö—Ä–∏—Ç–∏—á–Ω–æ', color: 'bg-amber-500', text: 'text-amber-600' };
        return { label: '–î–æ—Å—Ç–∞—Ç–Ω—å–æ', color: 'bg-green-500', text: 'text-green-600' };
    };

    const groupedInventory = inventory.reduce((acc, item) => {
        const cat = item.category || '–Ü–Ω—à–µ';
        if (!acc[cat]) acc[cat] = [];
        acc[cat].push(item);
        return acc;
    }, {});

    return (
        <div className="fade-in">
            <h2 className="text-2xl font-black mb-6 uppercase tracking-tighter">üì¶ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∫–ª–∞–¥–æ–º</h2>
            
            <div className="bg-white p-8 rounded-[40px] shadow-sm border border-gray-100 mb-10">
                <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end">
                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase ml-1">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <select className="w-full border-2 border-gray-50 p-3 rounded-xl mt-1 outline-none focus:border-brand-main font-bold"
                            value={newItem.category} onChange={e => setNewItem({...newItem, category: e.target.value})}>
                            {categories.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                    </div>
                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase ml-1">–ù–∞–∑–≤–∞</label>
                        <input className="w-full border-2 border-gray-50 p-3 rounded-xl mt-1 outline-none focus:border-brand-main"
                            value={newItem.item} onChange={e => setNewItem({ ...newItem, item: e.target.value })} placeholder="–ù–∞–∑–≤–∞"/>
                    </div>
                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase ml-1">–ú–æ–¥–µ–ª—å</label>
                        <input className="w-full border-2 border-gray-50 p-3 rounded-xl mt-1 outline-none focus:border-brand-main"
                            value={newItem.model} onChange={e => setNewItem({ ...newItem, model: e.target.value })} placeholder="–ú–∞—Ä–∫–∞"/>
                    </div>
                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase ml-1">–ö-—Å—Ç—å –∑–∞—Ä–∞–∑</label>
                        <input type="number" className="w-full border-2 border-gray-50 p-3 rounded-xl mt-1 outline-none focus:border-brand-main text-center font-bold"
                            value={newItem.quantity} onChange={e => setNewItem({ ...newItem, quantity: e.target.value })}/>
                    </div>
                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase ml-1">–ú—ñ–Ω. –ø–æ—Ä—ñ–≥</label>
                        <input type="number" className="w-full border-2 border-gray-100 p-3 rounded-xl mt-1 outline-none focus:border-orange-400 text-center font-bold"
                            value={newItem.minLimit} onChange={e => setNewItem({ ...newItem, minLimit: e.target.value })} title="–Ø–∫—â–æ —Å—Ç–∞–Ω–µ –º–µ–Ω—à–µ —Ü—å–æ–≥–æ —á–∏—Å–ª–∞ - —Å—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–∏—Ç—å—Å—è –Ω–∞ –ö—Ä–∏—Ç–∏—á–Ω–æ"/>
                    </div>
                    <button onClick={addItem} className="bg-brand-main text-white px-6 py-4 rounded-xl font-black text-[10px] uppercase tracking-widest hover:shadow-lg transition-all">–î–æ–¥–∞—Ç–∏</button>
                </div>
            </div>

            <div className="space-y-8">
                {Object.keys(groupedInventory).sort().map(cat => (
                    <div key={cat} className="bg-white rounded-[35px] shadow-sm border border-gray-100 overflow-hidden">
                        <div className="bg-gray-900 px-6 py-3 flex justify-between items-center">
                            <h3 className="text-white text-[10px] font-black uppercase tracking-[0.2em]">{cat}</h3>
                            <span className="text-gray-400 text-[9px] font-bold">{groupedInventory[cat].length} –ø–æ–∑–∏—Ü—ñ–π</span>
                        </div>
                        <table className="w-full text-left">
                            <thead className="bg-gray-50/50 border-b border-gray-100">
                                <tr>
                                    <th className="p-5 text-[9px] font-black uppercase text-gray-400">–¢–æ–≤–∞—Ä / –ú–æ–¥–µ–ª—å</th>
                                    <th className="p-5 text-[9px] font-black uppercase text-gray-400 text-center">–°—Ç–∞—Ç—É—Å</th>
                                    <th className="p-5 text-[9px] font-black uppercase text-gray-400 text-center">–ù–∞—è–≤–Ω—ñ—Å—Ç—å</th>
                                    <th className="p-5 text-[9px] font-black uppercase text-gray-400 text-right">–î—ñ—ó</th>
                                </tr>
                            </thead>
                            <tbody>
                                {groupedInventory[cat].map(item => {
                                    const status = getStockStatus(item.quantity, item.minLimit || 5);
                                    return (
                                        <tr key={item.id} className="border-b border-gray-50 last:border-0 hover:bg-gray-50/30 transition-colors">
                                            <td className="p-5">
                                                <div className="font-extrabold text-gray-900">{item.item}</div>
                                                <div className="text-[10px] text-gray-400 font-bold uppercase">{item.model}</div>
                                            </td>
                                            <td className="p-5 text-center">
                                                <div className={`inline-flex items-center gap-2 px-3 py-1 rounded-full ${status.color} bg-opacity-10 ${status.text} text-[9px] font-black uppercase tracking-tighter`}>
                                                    <div className={`w-1.5 h-1.5 rounded-full ${status.color}`}></div>
                                                    {status.label}
                                                </div>
                                            </td>
                                            <td className="p-5 text-center">
                                                <div className="flex items-center justify-center gap-3">
                                                    <input type="number" min="0" className="w-16 border-2 border-gray-100 rounded-xl p-2 text-center font-black focus:border-brand-main outline-none bg-gray-50"
                                                        value={item.quantity} onChange={e => updateQty(item.id, e.target.value)}/>
                                                    <span className="text-[10px] font-black text-gray-400 uppercase">{item.unit}</span>
                                                </div>
                                            </td>
                                            <td className="p-5 text-right">
                                                <button onClick={() => removeItem(item.id, item.item)} className="w-10 h-10 rounded-xl bg-red-50 text-red-400 hover:bg-red-500 hover:text-white transition-all font-bold">‚úï</button>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                ))}
            </div>
        </div>
    );
};
// ---–ü–ï–†–°–û–ù–ê–õ---
const StaffView = ({ users, shifts, logs, createUser, deleteUser, onUpdateProfile, currentUser, deleteShift, editShift }) => {
const [staffTab, setStaffTab] = useState('list');
const [showUserModal, setShowUserModal] = useState(false);
const [editingUser, setEditingUser] = useState(null);
const handleEditClick = (user) => {
    setEditingUser(user);
};

return (
    <div className="space-y-8 fade-in">
        <div className="flex justify-between items-center">
            <div className="flex bg-white p-2 rounded-[24px] shadow-sm border border-gray-100">
                <button onClick={() => setStaffTab('list')} className={`px-8 py-3 rounded-2xl text-xs font-black uppercase tracking-widest transition-all ${staffTab === 'list' ? 'bg-brand-dark text-white' : 'text-gray-400 hover:text-gray-600'}`}>–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥–∏</button>
                <button onClick={() => setStaffTab('shifts')} className={`px-8 py-3 rounded-2xl text-xs font-black uppercase tracking-widest transition-all ${staffTab === 'shifts' ? 'bg-brand-dark text-white' : 'text-gray-400 hover:text-gray-600'}`}>–ì—Ä–∞—Ñ—ñ–∫ –∑–º—ñ–Ω</button>
                <button onClick={() => setStaffTab('audit')} className={`px-8 py-3 rounded-2xl text-xs font-black uppercase tracking-widest transition-all ${staffTab === 'audit' ? 'bg-brand-dark text-white' : 'text-gray-400 hover:text-gray-600'}`}>–ê—É–¥–∏—Ç</button>
            </div>
        {staffTab === 'list' && (currentUser.role === '–î–∏—Ä–µ–∫—Ç–æ—Ä' || currentUser.role === '–ê–¥–º—ñ–Ω') && (
    <button onClick={() => { setEditingUser(null); setShowUserModal(true); }}
    className="bg-brand-main text-white px-6 py-3 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg hover:scale-105 transition-all"> + –î–æ–¥–∞—Ç–∏ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞</button>
)}
    </div>

{/* –°–ü–ò–°–û–ö –ü–†–ê–¶–Ü–í–ù–ò–ö–Ü–í */}
{staffTab === 'list' && (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {users.map((u) => (
            <div key={u.id} className="bg-white p-8 rounded-[40px] shadow-sm border border-gray-100 group relative">
                {/* –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è / –≤–∏–¥–∞–ª–µ–Ω–Ω—è */}
                <div className="absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-all">
                    {(currentUser.role === '–ê–¥–º—ñ–Ω' || currentUser.id === u.id) && (
                        <button onClick={() => handleEditClick(u)}
                            className="p-2 text-blue-400 hover:text-blue-600 bg-blue-50 rounded-xl transition-colors"
                            title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏"> ‚úé </button>
                    )}

                    {currentUser.role === '–ê–¥–º—ñ–Ω' && currentUser.id !== u.id && (
                        <button onClick={() => deleteUser(u.id)}
                        className="p-2 text-red-400 hover:text-red-600 bg-red-50 rounded-xl transition-colors"
                        title="–í–∏–¥–∞–ª–∏—Ç–∏"> ‚úï </button>
                    )}
                </div>

                {/* –ê–≤–∞—Ç–∞—Ä —Ç–∞ –æ—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è */}
                <div className="flex items-center gap-5 mb-6">
                    <img
                        src={u.avatar || 'https://via.placeholder.com/150'}
                        className="w-20 h-20 rounded-[30px] object-cover ring-4 ring-gray-50"
                    />
                    <div>
                        <h4 className="font-[900] text-gray-900 text-lg leading-tight">
                            {u.name}
                        </h4>
                        <div className="text-brand-main text-xs font-black uppercase tracking-widest mt-1">
                            {u.role}
                        </div>
                    </div>
                </div>

                {/* –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è */}
                <div className="space-y-3 pt-4 border-t border-gray-50 text-sm font-bold text-gray-700">
                    <p className="flex justify-between">
                        <span className="text-gray-400 text-[10px] uppercase">Email:</span> 
                        {u.email}
                    </p>

                    <p className="flex justify-between">
                        <span className="text-gray-400 text-[10px] uppercase">–¢–µ–ª–µ—Ñ–æ–Ω:</span> 
                        {u.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}
                    </p>

                    <p className="flex justify-between">
                        <span className="text-gray-400 text-[10px] uppercase">–î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è:</span> 
                        {u.birthday ? new Date(u.birthday).toLocaleDateString('uk-UA') : '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}
                    </p>
                </div>
            </div>
        ))}
    </div>
)}

{/* –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –°–¢–í–û–†–ï–ù–ù–Ø/–†–ï–î–ê–ì–£–í–ê–ù–ù–Ø */}
{(showUserModal || editingUser) && (
    <div className="fixed inset-0 bg-brand-dark/80 backdrop-blur-md flex items-center justify-center z-[110] p-6">
        <div className="bg-white rounded-[40px] w-full max-w-md p-10 fade-in shadow-2xl">
            <h2 className="text-2xl font-black mb-6 uppercase tracking-tight">
                {editingUser ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ' : '–ù–æ–≤–∏–π –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫'}
            </h2>
            <form onSubmit={(e) => {
                    e.preventDefault();
                    const fd = new FormData(e.target);
                    const userData = {
                        id: editingUser ? editingUser.id : Date.now(),
                        name: fd.get('name'),
                        email: fd.get('email'),
                        phone: fd.get('phone'),
                        birthday: fd.get('birthday'), // –î–æ–¥–∞—î–º–æ –∑–±—ñ—Ä –¥–∞—Ç–∏
                        role: fd.get('role') || (editingUser ? editingUser.role : 'worker'),
                    };

                    if (!editingUser) {
                        userData.password = fd.get('pass');
                        userData.avatar = null;
                        createUser(userData);
                        setShowUserModal(false);
                    } else {
                        userData.avatar = editingUser.avatar; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞—Ä–∏–π –∞–≤–∞—Ç–∞—Ä
                        onUpdateProfile(userData);
                        setEditingUser(null);
                    }
                }}
                className="space-y-4">
                {/* –ü–Ü–ë */}
                <div className="space-y-1">
                    <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1"> –ü–Ü–ë </label>
                    <input
                        name="name"
                        defaultValue={editingUser?.name}
                        placeholder="–ü–Ü–ë"
                        className="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold"
                        required />
                </div>
                {/* –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è */}
                <div className="space-y-1">
                    <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">
                        –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è
                    </label>
                    <input
                        name="birthday"
                        type="date"
                        defaultValue={editingUser?.birthday}
                        className="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold" />
                </div>
                {/* Email —Ç–∞ –¢–µ–ª–µ—Ñ–æ–Ω */}
                <div className="grid grid-cols-2 gap-4">
                    <div className="space-y-1">
                        <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">
                            Email
                        </label>
                        <input
                            name="email"
                            type="email"
                            defaultValue={editingUser?.email}
                            placeholder="Email"
                            className="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold"
                            required />
                    </div>
                    <div className="space-y-1">
                        <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1"> –¢–µ–ª–µ—Ñ–æ–Ω </label>
                        <input
                            name="phone"
                            defaultValue={editingUser?.phone}
                            placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"
                            className="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold" />
                    </div>
                </div>
                {/* –ü–∞—Ä–æ–ª—å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞) */}
                {!editingUser && (
                    <div className="space-y-1">
                        <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1"> –ü–∞—Ä–æ–ª—å </label>
                        <input
                            name="pass"
                            type="password"
                            placeholder="–ü–∞—Ä–æ–ª—å"
                            className="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold"
                            required />
                    </div>
                )}
                {/* –†–æ–ª—å */}
                <div className="space-y-1">
                    <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1"> –†–æ–ª—å</label>
                    {(currentUser.role === 'admin' || currentUser.role === '–ê–¥–º—ñ–Ω' || currentUser.role === '–î–∏—Ä–µ–∫—Ç–æ—Ä') ? (
                        <select
                            name="role"
                            defaultValue={editingUser?.role || '–ï–ª–µ–∫—Ç—Ä–∏–∫'}
                            className="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold outline-none focus:ring-2 ring-brand-main">
                            <option value="–ê–¥–º—ñ–Ω">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            <option value="–î–∏—Ä–µ–∫—Ç–æ—Ä">–î–∏—Ä–µ–∫—Ç–æ—Ä</option>
                            <option value="–ú–µ–Ω–µ–¥–∂–µ—Ä">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="–ë—É—Ö–≥–∞–ª—Ç–µ—Ä">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option>
                            <option value="–í–∏–∫–æ–Ω—Ä–æ–±">–í–∏–∫–æ–Ω—Ä–æ–±</option>
                            <option value="–ï–ª–µ–∫—Ç—Ä–∏–∫">–ï–ª–µ–∫—Ç—Ä–∏–∫</option>
                            <option value="–°–∞–Ω—Ç–µ—Ö–Ω—ñ–∫">–°–∞–Ω—Ç–µ—Ö–Ω—ñ–∫</option>
                            <option value="–ü—Ä–∏–±–∏—Ä–∞–ª—å–Ω–∏–∫">–ü—Ä–∏–±–∏—Ä–∞–ª—å–Ω–∏–∫(-—Ü—è)</option>
                        </select>
                    ) : (
                        <div className="p-4 bg-gray-100 rounded-2xl text-gray-500 font-bold italic">
                            {editingUser?.role || '–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫'}
                            <input
                                type="hidden"
                                name="role"
                                value={editingUser?.role || '–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫'} />
                        </div>
                    )}
                </div>
                {/* –ö–Ω–æ–ø–∫–∏ –°–∫–∞—Å—É–≤–∞—Ç–∏ / –ó–±–µ—Ä–µ–≥—Ç–∏ */}
                <div className="flex gap-3 pt-4">
                    <button
                        type="button"
                        onClick={() => {
                            setShowUserModal(false);
                            setEditingUser(null);
                        }}
                        className="flex-1 py-4 font-black uppercase text-[10px] text-gray-400">
                        –°–∫–∞—Å—É–≤–∞—Ç–∏
                    </button>
                    <button type="submit"
                        className="flex-1 bg-brand-main text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg active:scale-95 transition-all">
                        {editingUser ? '–ó–±–µ—Ä–µ–≥—Ç–∏' : '–°—Ç–≤–æ—Ä–∏—Ç–∏'}
                    </button>
                </div>
            </form>
        </div>
    </div>
)}


{/* –†–û–ó–ö–õ–ê–î –ß–ï–†–ì–£–í–ê–ù–¨ */}
{staffTab === 'shifts' && (
    <div className="bg-white rounded-[25px] md:rounded-[40px] p-5 md:p-10 border border-gray-100 shadow-sm fade-in">
        <div className="flex justify-between items-center mb-6 md:mb-8">
            <h3 className="text-lg md:text-xl font-[1000] tracking-tight uppercase italic">–†–æ–∑–∫–ª–∞–¥ —á–µ—Ä–≥—É–≤–∞–Ω—å</h3>
            <div className="flex items-center gap-4">
                <div className="bg-brand-main/10 text-brand-main px-4 py-2 rounded-xl text-[10px] font-black uppercase">
                    {shifts.length} –∑–º—ñ–Ω
                </div>
                {currentUser?.role === '–ê–¥–º—ñ–Ω' && (
                    <button 
                        onClick={() => window.dispatchEvent(new CustomEvent('openShiftModal'))}
                        className="bg-brand-main text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-blue-600 transition-all shadow-lg"> 
                        + –î–æ–¥–∞—Ç–∏ –∑–º—ñ–Ω—É/–≥—Ä–∞—Ñ—ñ–∫ 
                    </button>
                )}
            </div>
        </div>
        <div className="table-container custom-scroll">
            <table className="w-full text-left min-w-[600px]">
                <thead className="bg-gray-50/50 text-[10px] font-black uppercase text-gray-400 tracking-widest">
                    <tr>
                        <th className="p-4 md:p-5 rounded-l-2xl">–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫</th>
                        <th className="p-4 md:p-5">–ß–∞—Å / –ü–µ—Ä—ñ–æ–¥</th>
                        <th className="p-4 md:p-5">–¢–∏–ø</th>
                        <th className="p-4 md:p-5 rounded-r-2xl text-right">–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody className="text-xs md:text-sm font-bold text-gray-700">
                    {shifts.length > 0 ? shifts.map(shift => {
                        const worker = users.find(u => u.id === Number(shift.userId));
                        return (
                            <tr key={shift.id} className="border-b border-gray-50 hover:bg-gray-50/50 transition-colors">
                                <td className="p-4 md:p-5">
                                    <div className="flex items-center gap-3">
                                        <div className="w-8 h-8 bg-brand-main/10 rounded-lg flex items-center justify-center text-brand-main text-[10px]">
                                            {worker ? worker.name[0] : '?'}
                                        </div>
                                        <div>
                                            <div className="font-black text-gray-900">{worker ? worker.name : '–ù–µ–≤—ñ–¥–æ–º–æ'}</div>
                                            <div className="text-[9px] uppercase text-gray-400">{worker?.role}</div>
                                        </div>
                                    </div>
                                </td>
                                <td className="p-4 md:p-5">
                                    {shift.isRecurring ? (
                                        <div className="flex flex-col">
                                            <span className="text-brand-main font-black uppercase text-[10px]">{shift.daysRange}</span>
                                            <span className="text-gray-400">{shift.timeRange}</span>
                                        </div>
                                    ) : (
                                        <div className="text-gray-500">
                                            {new Date(shift.start).toLocaleString('uk-UA', {day: 'numeric', month: 'short', hour: '2-digit', minute:'2-digit'})}
                                        </div>
                                    )}
                                </td>
                                <td className="p-4 md:p-5">
                                    <span className={`px-3 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-wider ${
                                        shift.type === 'night' ? 'bg-indigo-50 text-indigo-500' : 'bg-orange-50 text-orange-500'
                                    }`}>
                                        {shift.type === 'night' ? '–ù—ñ—á–Ω–∞' : '–î–µ–Ω–Ω–∞'}
                                    </span>
                                </td>
                                <td className="p-4 md:p-5 text-right">
                                    {currentUser?.role === '–ê–¥–º—ñ–Ω' && (
                                        <div className="flex justify-end gap-2">
                                            <button onClick={() => editShift(shift)} className="p-2 hover:bg-blue-50 text-blue-500 rounded-lg transition-all">‚úé</button>
                                            <button onClick={() => deleteShift(shift.id)} className="p-2 hover:bg-red-50 text-red-500 rounded-lg transition-all">‚úï</button>
                                        </div>
                                    )}
                                </td>
                            </tr>
                        )
                    }) : (
                        <tr>
                            <td colSpan="4" className="p-12 text-center text-gray-300 font-black uppercase text-[10px]">–†–æ–∑–∫–ª–∞–¥ –ø–æ—Ä–æ–∂–Ω—ñ–π</td>
                        </tr>
                    )}
                </tbody>
            </table>
        </div>
    </div>
)}

{/* –ê–£–î–ò–¢ (LOGS) */}
    {staffTab === 'audit' && (
        <div className="bg-brand-dark rounded-[40px] p-10 shadow-2xl flex flex-col overflow-hidden max-h-[600px]">
            <h3 className="text-xl font-black mb-8 tracking-tight text-white">–°–∏—Å—Ç–µ–º–Ω–∏–π –∞—É–¥–∏—Ç</h3>
        <div className="overflow-y-auto custom-scroll space-y-4 pr-2">
        {logs.map(log => (
        <div key={log.id} className="bg-white/5 p-4 rounded-2xl border border-white/5 flex justify-between items-center">
            <div>
                <div className="text-white font-bold text-sm">{log.action}</div>
                <div className="text-gray-400 text-xs">{log.details}</div>
            </div>
            <div className="text-right">
                <div className="text-brand-main text-xs font-black uppercase">{log.user}</div>
                <div className="text-gray-600 text-[10px]">{new Date(log.date).toLocaleString()}</div>
            </div>
            </div>
            ))}
         </div>
        </div>
       )}
    </div>
   );
 };
 // --- –ì–û–õ–û–í–ù–ò–ô –î–û–î–ê–¢–û–ö ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showModal, setShowModal] = useState(false);
            const [archiveTasks, setArchiveTasks] = useState([]);
            const [users, setUsers] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [inventory, setInventory] = useState([]);
            const [shifts, setShifts] = useState([]);
            const [logs, setLogs] = useState([]);
			const [complexes, setComplexes] = useState([]);
			const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
			const [showShiftModal, setShowShiftModal] = useState(false);
            const [shiftMode, setShiftMode] = React.useState('single'); 
            const [editingShift, setEditingShift] = React.useState(null);
           useEffect(() => {
    const connectToServer = async () => {
        try {
            const response = await fetch(`${API_URL}/data`);
            if (!response.ok) throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π');
            const data = await response.json();
            
            if (data) {
                if (data.users) {
                    setUsers(data.users);

                    // --- –î–û–î–ê–ô–¢–ï –¶–ï–ô –ë–õ–û–ö –î–õ–Ø –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–á –§–û–¢–û ---
                    const session = JSON.parse(localStorage.getItem(SESSION_KEY));
                    if (session && session.user) {
                        // –®—É–∫–∞—î–º–æ –∞–∫—Ç—É–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ —Ü—å–æ–≥–æ –∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –æ—Ç—Ä–∏–º–∞–Ω–æ–º—É —Å–ø–∏—Å–∫—É
                        const freshUserData = data.users.find(u => u.id === session.user.id);
                        if (freshUserData) {
                            setCurrentUser(freshUserData); // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —é–∑–µ—Ä–∞ (–∑ –Ω–æ–≤–∏–º —Ñ–æ—Ç–æ)
                        }
                    }
                    // ----------------------------------------------
                }
                
                if (data.tasks) setTasks(data.tasks);
                if (data.complexes) setComplexes(data.complexes);
                if (data.inventory) setInventory(data.inventory);
                if (data.shifts) setShifts(data.shifts);
                if (data.logs) setLogs(data.logs);
                if (data.archiveTasks) setArchiveTasks(data.archiveTasks);
                
                console.log("–ó–≤'—è–∑–æ–∫ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –¥–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ");
            }
        } catch (err) {
            console.log("–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–µ—Ä–∞ (localhost:3000)...");
            setTimeout(connectToServer, 2000); 
        }
    };
    connectToServer();
}, []);
            const [currentUser, setCurrentUser] = useState(() => {
                const session = JSON.parse(localStorage.getItem(SESSION_KEY));
                if (session && new Date().getTime() < session.expiry) return session.user;
                return null;
            });
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
            useEffect(() => {
                fetch(`${API_URL}/data`)
                    .then(res => res.json())
                    .then(data => {
                        console.log("–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ:", data);
                        if (data.users) setUsers(data.users);
                        if (data.tasks) setTasks(data.tasks);
                        if (data.inventory) setInventory(data.inventory);
                        if (data.shifts) setShifts(data.shifts);
                        if (data.logs) setLogs(data.logs);
                        if (data.archiveTasks) setArchiveTasks(data.archiveTasks);
						if (data.complexes) setComplexes(data.complexes);
                    })
                    .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:", err));
            }, []);

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–º—ñ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const saveToServer = (dataToSave) => {
                fetch(`${API_URL}/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSave)
                })
                .then(res => res.json())
                .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:", err));
            };
            const isFirstRun = useRef(true);
            useEffect(() => {
                if (isFirstRun.current) { isFirstRun.current = false; return; }
                saveToServer({ tasks });
            }, [tasks]);

            useEffect(() => { if (!isFirstRun.current) saveToServer({ inventory }); }, [inventory]);
            useEffect(() => { if (!isFirstRun.current) saveToServer({ shifts }); }, [shifts]);
            useEffect(() => { if (!isFirstRun.current) saveToServer({ logs }); }, [logs]);
            useEffect(() => { if (!isFirstRun.current) saveToServer({ archiveTasks }); }, [archiveTasks]);
            useEffect(() => { if (!isFirstRun.current) saveToServer({ complexes }); }, [complexes]);
            useEffect(() => { if (!isFirstRun.current) saveToServer({ users }); }, [users]);
			useEffect(() => {
				const handleOpen = () => setShowShiftModal(true);
				window.addEventListener('openShiftModal', handleOpen);
				return () => window.removeEventListener('openShiftModal', handleOpen);
			}, []);
           const handleLogin = (e) => {
    if (e && typeof e.preventDefault === 'function') {
        e.preventDefault();
    }
    let email, pass;
    
    if (e && e.target && e.target.email) {
        email = e.target.email.value;
        pass = e.target.password.value;
    } else {
        email = document.querySelector('input[type="email"]')?.value || 
                document.querySelector('input[name="email"]')?.value;
        pass = document.querySelector('input[type="password"]')?.value || 
               document.querySelector('input[name="password"]')?.value;
    }

    console.log("–°–ø—Ä–æ–±–∞ –≤—Ö–æ–¥—É –¥–ª—è:", email);

    const user = users.find(u => u.email === email && u.passwordHash === pass);

    if (user) {
        const { avatar, ...userForStorage } = user;
        
        const sessionData = { 
            user: userForStorage, 
            loginTime: Date.now() 
        };

        try {
            localStorage.removeItem(SESSION_KEY);
            localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
            setCurrentUser(user); 
            
            addLog('–°–∏—Å—Ç–µ–º–∞', `–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É: ${user.name}`);
        } catch (error) {
            console.error("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø–∞–º'—è—Ç—ñ:", error);
            localStorage.clear(); 
            alert("–ü–æ–º–∏–ª–∫–∞ –ø–∞–º'—è—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞. –ú–∏ –æ—á–∏—Å—Ç–∏–ª–∏ –∫–µ—à, —Å–ø—Ä–æ–±—É–π—Ç–µ —É–≤—ñ–π—Ç–∏ —â–µ —Ä–∞–∑.");
        }
    } else {
        alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å');
    }
};
            const addLog = async (action, details, userName = currentUser?.name) => {
    const newLog = { 
        id: Date.now(), 
        date: new Date().toISOString(), 
        action, 
        details, 
        user: userName || "–°–∏—Å—Ç–µ–º–∞" 
    };

    // –û–Ω–æ–≤–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å—Ç–µ–π—Ç
    setLogs(prev => [newLog, ...prev]);

    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    try {
        await fetch(`${API_URL}/logs`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newLog)
        });
    } catch (error) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤:", error);
    }
};

            const deleteShift = (id) => {
                if (window.confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∑–º—ñ–Ω—É –∑ —Ä–æ–∑–∫–ª–∞–¥—É?')) {
                    setShifts(prev => prev.filter(s => s.id !== id));
                    addLog('–ü–µ—Ä—Å–æ–Ω–∞–ª', '–í–∏–¥–∞–ª–µ–Ω–æ –∑–º—ñ–Ω—É –∑ —Ä–æ–∑–∫–ª–∞–¥—É');
                }
            };

            const editShift = (shift) => {
                console.log("–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–∏:", shift); // –î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ
                setEditingShift(shift);
                setShiftMode(shift.isRecurring ? 'recurring' : 'single');
                setShowShiftModal(true);
            };
            const updateTaskStatus = (taskId, newStatus) => {
                setTasks(prev => prev.map(t => t.id === taskId ? {...t, status: newStatus} : t));
            };
            const archiveTask = (taskId) => {
                const taskToArchive = tasks.find(t => t.id === taskId);
                if (taskToArchive) {
                    setArchiveTasks(prev => [...prev, { ...taskToArchive, archivedAt: new Date().toISOString() }]);
                    setTasks(prev => prev.filter(t => t.id !== taskId));
                    addLog("–ê—Ä—Ö—ñ–≤", `–ó–∞–≤–¥–∞–Ω–Ω—è "${taskToArchive.title}" –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤`);
                }
            };
            const deleteTask = (taskId, isFromArchive = false) => {
                if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è –Ω–∞–∑–∞–≤–∂–¥–∏?")) {
                    if (isFromArchive) {
                        setArchiveTasks(prev => prev.filter(t => t.id !== taskId));
                    } else {
                        setTasks(prev => prev.filter(t => t.id !== taskId));
                    }
                }
            };
            const createUser = (userData) => {
                const newUser = {
                    id: Date.now(),
                    ...userData,
                    passwordHash: userData.password, 
                    avatar: null, 
                    status: 'active',
                    assignedComplexes: []
                };
                setUsers(prev => [...prev, newUser]);
                addLog("–ö–æ–º–∞–Ω–¥–∞", `–°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ${newUser.name}`);
            };
            const deleteUser = (userId) => {
                if (userId === currentUser.id) return alert("–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–ª–∞—Å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞!");
                if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞?")) {
                    setUsers(prev => prev.filter(u => u.id !== userId));
                    addLog("–ö–æ–º–∞–Ω–¥–∞", `–í–∏–¥–∞–ª–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ID: ${userId}`);
                }
            };
            const updateProfile = (updatedData) => {
                const newUserData = { ...currentUser, ...updatedData };
                setUsers(prev => prev.map(u => u.id === updatedData.id ? { ...u, ...updatedData } : u));
                
                if (updatedData.id === currentUser.id) {
                    setCurrentUser(prev => ({ ...prev, ...updatedData }));
                    const session = JSON.parse(localStorage.getItem(SESSION_KEY));
                    if (session) {
                        session.user = { ...session.user, ...updatedData };
                        localStorage.setItem(SESSION_KEY, JSON.stringify(session));
                    }
                }
                addLog("–ë–µ–∑–ø–µ–∫–∞", `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${currentUser.name} –æ–Ω–æ–≤–∏–≤ –ø—Ä–æ—Ñ—ñ–ª—å`);
            };
            const handleAvatarUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        updateProfile({ ...currentUser, avatar: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };
            if (!currentUser) return <LoginScreen onLogin={handleLogin} users={users} />;
            return (
            <div className="flex h-screen bg-[#f8fafc] overflow-hidden relative">
        {/* –®–∞–ø–∫–∞ –º–µ–Ω—é –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ */}
        <div className="lg:hidden fixed top-0 left-0 right-0 h-16 bg-brand-dark flex items-center justify-between px-6 z-[60]">
            <div className="text-white font-black uppercase tracking-tighter text-sm">HomeTeam</div>
            <button 
                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} 
                className="text-white p-2" >
                {isMobileMenuOpen ? '‚úï' : '‚ò∞'}
            </button>
        </div>
        {/* SIDEBAR*/}
        <aside className={`
            fixed inset-y-0 left-0 z-[100] w-72 bg-brand-dark text-white flex flex-col p-6 
            transition-transform duration-300 ease-in-out shadow-2xl
            ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} 
            lg:relative lg:translate-x-0 lg:w-80 lg:p-8 lg:shadow-none`}>
            {/* –õ–æ–≥–æ */}
            <div className="mb-12 px-2">
                <div className="flex items-center gap-4">
                   <div className="flex flex-col items-start select-none">
                        <h2 className="text-xl lg:text-2xl font-bold tracking-tighter uppercase flex items-center leading-none">
                            <span className="italic text-white-400 flex items-center justify-center">Home </span>
                            <span className="italic ml-1 text-[#0566C7]"> Team</span>
                        </h2>
                       <span className="text-[10px] font-black text-gray-400 tracking-[0.4em] uppercase mt-1.5 whitespace-nowrap"> Service Platform</span>
                    </div>
                </div>
            </div>

{/* –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */}
<nav className="flex-1 space-y-2 lg:space-y-3">
    {[
       { id: 'dashboard', label: '–î–∞—à–±–æ—Ä–¥', icon: 'M3 12l2-2 7-7 7 7 2 2v8a1 1 0 01-1 1h-5v-6H9v6H4a1 1 0 01-1-1v-8z' },
       { id: 'kanban', label: '–î–æ—à–∫–∞ –∑–∞–¥–∞—á', icon: 'M4 4a2 2 0 012-2h12a2 2 0 012 2v16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 4h2v8H7V8zm4 2h2v6h-2v-6zm4-1h2v7h-2V9z' },
       { id: 'inventory', label: '–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏', icon: 'M3 7l9-4 9 4-9 4-9-4zm0 5l9 4 9-4v7l-9 4-9-4v-7z' },
       { id: 'staff', label: '–ö–æ–º–∞–Ω–¥–∞', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M9 11a4 4 0 100-8 4 4 0 000 8zm0 2c-3.314 0-6 1.686-6 4v3h12v-3c0-2.314-2.686-4-6-4z' },
       { id: 'complexes', label: '–ö–æ–º–ø–ª–µ–∫—Å–∏', icon: 'M4 21V5a2 2 0 012-2h4v18H4zm6 0V3h4v18h-4zm6 0V8h4v13h-4z' },
       { id: 'archive', label: '–ê—Ä—Ö—ñ–≤', icon: 'M3 7a2 2 0 012-2h14a2 2 0 012 2v2H3V7zm2 4h14v8a2 2 0 01-2 2H7a2 2 0 01-2-2v-8zm5 2h4v4h-4v-4z' },
       { id: 'profile', label: '–ú—ñ–π –∫–∞–±—ñ–Ω–µ—Ç', icon: 'M12 12a5 5 0 100-10 5 5 0 000 10zm0 2c-4.418 0-8 2.239-8 5v3h16v-3c0-2.761-3.582-5-8-5z' }
    ].map(item => (
        <button 
            key={item.id}
            onClick={() => {
                setActiveTab(item.id);
                setIsMobileMenuOpen(false);
            }}
            className={`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all font-black text-xs uppercase tracking-[0.15em] ${activeTab === item.id ? 'bg-white/10 text-white shadow-inner' : 'text-gray-500 hover:text-white hover:bg-white/5'}`}
        >
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d={item.icon}/>
            </svg>
            {item.label}
        </button>
    ))}
</nav>

{/* –ü–†–û–§–Ü–õ–¨ –í–ù–ò–ó–£ */}
            <div className="mt-auto pt-10">
                <div className="bg-black/30 p-5 rounded-[30px] border border-white/5 flex items-center gap-4">
                    <img 
                        src={currentUser.avatar || 'https://via.placeholder.com/150'} 
                        className="w-12 h-12 rounded-[18px] object-cover ring-2 ring-brand-main/20 shrink-0" 
                    />
                    <div className="flex-1 min-w-0 py-1">
                        {/* –ü—Ä–∏–±—Ä–∞–Ω–æ truncate, –¥–æ–¥–∞–Ω–æ leading-tight –¥–ª—è –≥–∞—Ä–Ω–æ–≥–æ –≤–∏–≥–ª—è–¥—É –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å—ñ */}
                        <div className="font-black text-sm leading-tight break-words">
                            {currentUser.name}
                        </div>
                        <div className="text-[10px] text-brand-main font-black uppercase tracking-widest mt-1">
                            {currentUser.role}
                        </div>
                    </div>
                    <button 
                        onClick={() => {localStorage.removeItem(SESSION_KEY); setCurrentUser(null);}} 
                        className="text-gray-600 hover:text-red-500 transition-colors shrink-0"
                    >
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

{/* CONTENT */}
        <main className="flex-1 flex flex-col min-w-0 overflow-hidden pt-16 lg:pt-0">
            <header className="h-20 lg:h-24 bg-white border-b border-gray-100 flex items-center justify-between px-6 lg:px-12 shrink-0">
               <div className="min-w-0">
    <h1 className="text-lg lg:text-2xl font-[950] text-gray-900 tracking-tight uppercase truncate">
        {activeTab === 'dashboard' ? '–ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è' : 
         activeTab === 'staff' ? '–ö–æ–º–∞–Ω–¥–∞' : 
         activeTab === 'profile' ? '–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å' : activeTab}
    </h1>
    <p className="hidden sm:block text-[10px] font-black text-gray-400 uppercase tracking-widest mt-1">
        {new Date().toLocaleDateString('uk-UA', { day: 'numeric', month: 'long', weekday: 'short' })
            .replace('–ø—Ç', "–ø'—è—Ç–Ω–∏—Ü—è") // –ù–∞ –≤–∏–ø–∞–¥–æ–∫ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è
            .replace('–ü—Ç', "–ü'—è—Ç–Ω–∏—Ü—è")
        }
    </p>
</div>
                <div className="flex items-center gap-3 lg:gap-6">
                    <button 
                        onClick={() => setShowModal(true)} 
                        className="bg-brand-main text-white px-4 lg:px-10 py-3 lg:py-4 rounded-xl lg:rounded-2xl font-[900] text-[10px] lg:text-xs uppercase tracking-widest shadow-xl shadow-blue-500/20 active:scale-95 transition-all"
                    >
                        + <span className="hidden sm:inline">–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</span><span className="sm:hidden">–ó–∞–≤–¥–∞–Ω–Ω—è</span>
                    </button>
                </div>
            </header>
                        <div className="flex-1 overflow-y-auto p-12 custom-scroll">
      {activeTab === 'dashboard' && (
    <div className="space-y-10 fade-in pb-12">
        {/* –ö–ê–†–¢–ö–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            {[
                { label: '–ó–∞—è–≤–∫–∏', val: tasks.length, icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2', col: 'blue', desc: '–í—Å—å–æ–≥–æ –≤ –±–∞–∑—ñ' },
                { label: '–í —Ä–æ–±–æ—Ç—ñ', val: tasks.filter(t => t.status === 'in-progress').length, icon: 'M13 10V3L4 14h7v7l9-11h-7z', col: 'amber', desc: '–ê–∫—Ç–∏–≤–Ω—ñ –∑–∞—Ä–∞–∑' },
                { label: '–°–∫–ª–∞–¥', val: inventory.length, icon: 'M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4', col: 'red', desc: '–û–¥–∏–Ω–∏—Ü—å —Ç–æ–≤–∞—Ä—É' },
                { label: '–ö–æ–º–∞–Ω–¥–∞', val: users.length, icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z', col: 'green', desc: '–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤' }
            ].map(s => (
                <div key={s.label} className="bg-white p-8 rounded-[48px] shadow-sm border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all group">
                    <div className={`w-14 h-14 rounded-2xl bg-${s.col}-50 text-${s.col}-500 flex items-center justify-center mb-6 group-hover:rotate-12 transition-transform`}>
                        <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d={s.icon}/></svg>
                    </div>
                    <div className="text-[10px] font-black text-gray-400 uppercase tracking-widest">{s.label}</div>
                    <div className="flex items-baseline gap-2">
                        <div className="text-4xl font-[950] text-gray-900 mt-2">{s.val}</div>
                        <div className="text-[10px] font-bold text-gray-300 lowercase">{s.desc}</div>
                    </div>
                </div>
            ))}
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
    {/* –û–°–¢–ê–ù–ù–Ü –î–Ü–á */}
    <div className="lg:col-span-2 bg-white p-10 rounded-[48px] shadow-sm border border-gray-100">
        <div className="flex justify-between items-center mb-8">
            <h3 className="text-xl font-black flex items-center gap-3">
                <span className="w-2 h-6 bg-brand-main rounded-full"></span> –û—Å—Ç–∞–Ω–Ω—ñ –¥—ñ—ó
            </h3>
            <button className="text-[10px] font-black text-brand-main uppercase tracking-widest hover:underline">–ê—Ä—Ö—ñ–≤ –ª–æ–≥—ñ–≤</button>
        </div>
        <div className="space-y-4">
            {logs.slice(0, 6).map(log => (
                <div key={log.id} className="flex gap-4 items-center p-4 rounded-3xl hover:bg-gray-50 transition-all border border-transparent hover:border-gray-100 group">
                    <div className="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-lg group-hover:bg-white shadow-sm">
                        {log.action.includes('–°—Ç–≤–æ—Ä–µ–Ω–Ω—è') ? '‚ûï' : log.action.includes('–í–∏–¥–∞–ª–µ–Ω–Ω—è') ? 'üóëÔ∏è' : 'üìù'}
                    </div>
                    <div className="flex-1 min-w-0">
                        <div className="font-extrabold text-gray-800 text-sm truncate">{log.details}</div>
                        <div className="text-[10px] font-bold text-gray-400 uppercase">{log.action} ‚Ä¢ {log.user}</div>
                    </div>
                    <div className="text-[10px] font-bold text-gray-300">
                        {new Date(log.date || Date.now()).toLocaleTimeString('uk-UA', {hour: '2-digit', minute:'2-digit'})}
                    </div>
                </div>
            ))}
        </div>
    </div>

    {/* –¶–ï–ù–¢–† –ï–§–ï–ö–¢–ò–í–ù–û–°–¢–Ü (–ù–û–í–ò–ô) */}
    <div className="bg-brand-dark text-white p-10 rounded-[48px] shadow-2xl relative overflow-hidden group border border-white/5">
        <div className="absolute -right-10 -bottom-10 w-40 h-40 bg-brand-main/20 rounded-full blur-3xl group-hover:bg-brand-main/40 transition-all duration-700"></div>
        
        <div className="relative z-10 space-y-8">
            <div className="flex justify-between items-start">
                <div>
                    <h3 className="text-xl font-[950] tracking-tight mb-1">–°—Ç–∞—Ç—É—Å CRM</h3>
                    <div className="flex items-center gap-2">
                        <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                        <span className="text-[10px] font-black uppercase tracking-widest text-gray-400 italic">Live System</span>
                    </div>
                </div>
                <div className="bg-white/10 p-3 rounded-2xl backdrop-blur-md">
                    <svg className="w-6 h-6 text-brand-main" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
            </div>

            {/* –°–¢–ê–¢–ò–°–¢–ò–ö–ê: –ì–û–¢–û–í–û –¢–ê –¢–†–ï–ë–ê –ó–†–û–ë–ò–¢–ò */}
<div className="grid grid-cols-2 gap-4 border-y border-white/10 py-6">
    <div className="text-center">
        <div className="text-2xl font-[950] text-white">
            {/* –ë–µ—Ä–µ–º–æ –≤—Å—ñ –≤–∏–∫–æ–Ω–∞–Ω—ñ */}
            {tasks.filter(t => t.status === 'completed' || t.status === 'done').length}
        </div>
        <div className="text-[9px] font-black uppercase tracking-[0.2em] text-green-400 mt-1">–ì–æ—Ç–æ–≤–æ</div>
    </div>
    <div className="text-center border-l border-white/10">
        <div className="text-2xl font-[950] text-white">
            {/* –¢–£–¢ –ó–ú–Ü–ù–ï–ù–û: –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç—ñ, —â–æ "–¢—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏" */}
            {tasks.filter(t => t.status === 'todo' || t.status === 'new').length}
        </div>
        <div className="text-[9px] font-black uppercase tracking-[0.2em] text-amber-400 mt-1">–¢—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏</div>
    </div>
</div>
            {/* –ü–†–û–ì–†–ï–°-–ë–ê–† */}
            <div className="space-y-3">
                <div className="flex justify-between text-[10px] font-black uppercase tracking-widest text-gray-400">
                    <span>–í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–ª–∞–Ω—É</span>
                    <span className="text-white">
                        {Math.round((tasks.filter(t => t.status === 'completed' || t.status === 'done').length / (tasks.length || 1)) * 100)}%
                    </span>
                </div>
                <div className="h-3 bg-white/5 rounded-full overflow-hidden p-0.5 border border-white/5">
                    <div 
                        className="h-full bg-gradient-to-r from-brand-main to-blue-400 rounded-full transition-all duration-1000 shadow-[0_0_15px_rgba(59,130,246,0.3)]" 
                        style={{ width: `${(tasks.filter(t => t.status === 'completed' || t.status === 'done').length / (tasks.length || 1)) * 100}%` }}
                    ></div>
                </div>
            </div>

            {/* –ö–ù–û–ü–ö–ò –î–Ü–ô */}
            <div className="grid grid-cols-1 gap-3">
                <button onClick={() => window.print()} className="flex items-center justify-between p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/5 transition-all text-left group/btn">
                    <span className="text-[10px] font-black uppercase tracking-widest">–ï–∫—Å–ø–æ—Ä—Ç –∑–≤—ñ—Ç—É</span>
                    <span className="text-gray-400 text-[10px]">PDF/CSV</span>
                </button>

                <button 
                    onClick={() => {
                        const done = tasks.filter(t => t.status === 'completed' || t.status === 'done').length;
                        const pending = tasks.filter(t => t.status === 'pending').length;
                        const inProgress = tasks.filter(t => t.status === 'in-progress').length;
                        
                        alert(
                            `üìä –ü–Ü–î–°–£–ú–û–ö –î–ù–Ø\n` +
                            `----------------------\n` +
                            `‚úÖ –í–ò–ö–û–ù–ê–ù–û: ${done}\n` +
                            `‚öôÔ∏è –£ –†–û–ë–û–¢–Ü: ${inProgress}\n` +
                            `----------------------\n` +
                            `–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: ${Math.round((done / (tasks.length || 1)) * 100)}%`
                        );
                    }}
                    className="w-full py-4 bg-white text-brand-dark rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-brand-main hover:text-white transition-all shadow-xl active:scale-95"
                >
                    üöÄ –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –¥–Ω—è
                </button>
            </div>
        </div>
    </div>
</div>

        {/* –ù–û–í–ò–ô –§–£–¢–ï–† */}
        <footer className="mt-16 pt-10 border-t border-gray-100">
            <div className="flex flex-col md:flex-row justify-between items-center gap-8">
                <div className="flex items-center gap-4">
                    <div className="bg-gray-900 text-white w-12 h-12 rounded-[20px] flex items-center justify-center font-black text-xl shadow-lg">HT</div>
                    <div>
                        <h4 className="font-black text-gray-900 leading-none mb-1">Home Team CRM</h4>
                        <p className="text-[9px] font-black text-gray-400 uppercase tracking-[0.2em]">–°–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–ª—è "–£–∫—Ä –ñ–∏—Ç–ª–æ –°–µ—Ä–≤—ñ—Å"</p>
                    </div>
                </div>

                <div className="flex gap-10">
                    <div className="hidden md:block">
                        <p className="text-[10px] font-black text-gray-300 uppercase tracking-widest mb-2 text-center">–°—Ç–∞—Ç—É—Å</p>
                        <p className="text-sm font-bold text-green-500 flex items-center gap-2">
                            <span className="w-2 h-2 bg-green-500 rounded-full animate-ping"></span> –°–µ—Ä–≤–µ—Ä–∏ –æ–Ω–ª–∞–π–Ω
                        </p>
                    </div>
                    <div className="h-10 w-[1px] bg-gray-100 hidden md:block"></div>
                    <div>
                        <p className="text-[10px] font-black text-gray-300 uppercase tracking-widest mb-2 text-center">–ß–∞—Å —Å–∏—Å—Ç–µ–º–∏</p>
                        <p className="text-sm font-black text-gray-900 tabular-nums">
                            {new Date().toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' })}
                        </p>
                    </div>
                </div>

                <div className="flex flex-col items-center md:items-end text-center md:text-right">
                <p className="text-[9px] font-black text-black-300 uppercase tracking-[0.2em] leading-relaxed">
                    ¬© 2026 Home Team ‚Ä¢ –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ
                </p>
                <p className="text-[9px] font-bold text-gray-400 uppercase tracking-widest mt-1">
                    –†–æ–∑—Ä–æ–±–Ω–∏—Ü—è: <span className="text-gray-500">–í–µ—Ä–æ–Ω—ñ–∫–∞ –õ–µ–±–µ–¥–æ–≤—Å—å–∫–∞</span>
                </p>
            </div>
            </div>
        </footer>
    </div>
)}
{activeTab === 'kanban' && (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-10 h-full min-h-[600px]">
        {['todo', 'in-progress', 'done'].map((statusId) => (
            <div key={statusId} className="flex flex-col h-full">
                <div className="flex items-center justify-between mb-8 px-5">
                    <div className="flex items-center gap-4">
                        <div className={`w-3 h-3 rounded-full ${statusId === 'todo' ? 'bg-gray-300' : statusId === 'in-progress' ? 'bg-brand-main' : 'bg-green-500'}`}></div>
                        <h3 className="font-[950] text-gray-900 uppercase text-xs tracking-widest">
                            {statusId === 'todo' ? '–¢—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏' : statusId === 'in-progress' ? '–£ —Ä–æ–±–æ—Ç—ñ' : '–ì–æ—Ç–æ–≤–æ'}
                        </h3>
                    </div>
                    <span className="bg-white text-brand-main px-4 py-1 rounded-full text-[11px] font-[900] shadow-sm ring-1 ring-gray-100">
                        {tasks.filter(t => t.status === statusId).length}
                    </span>
                </div>
                
                <div className="bg-gray-100/40 rounded-[50px] p-5 flex-1 overflow-y-auto custom-scroll space-y-5">
                    {tasks.filter(task => task.status === statusId).map(task => {
                        const worker = users.find(u => Number(u.id) === Number(task.assignee));
                        const complex = complexes.find(c => String(c.id) === String(task.locationId));

                        return (
                            <div key={task.id} className="bg-white p-8 rounded-[35px] shadow-sm border border-gray-100 task-card group">
                                <div className="flex justify-between items-start mb-5">
                                    <span className={`text-[9px] font-black px-3 py-1.5 rounded-lg uppercase tracking-widest ${task.priority === 'Critical' ? 'bg-red-100 text-red-500' : 'bg-blue-50 text-blue-500'}`}>
                                        {task.priority}
                                    </span>
                                    <div className="flex gap-2">
                                        <button onClick={() => archiveTask(task.id)} title="–í –∞—Ä—Ö—ñ–≤" className="w-8 h-8 rounded-lg bg-gray-50 flex items-center justify-center hover:bg-amber-100 text-xs">üì¶</button>
                                        <button onClick={() => deleteTask(task.id)} title="–í–∏–¥–∞–ª–∏—Ç–∏" className="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center text-red-400 font-bold hover:bg-red-100">‚úï</button>
                                    </div>
                                </div>
                                
                                <h4 className="font-extrabold text-gray-900 leading-snug mb-2 text-lg tracking-tight">{task.title}</h4>
                                
                                <div className="flex items-center gap-2 text-gray-400 font-bold text-[10px] mb-6 uppercase tracking-wider">
                                    <svg className="w-3 h-3 text-brand-main" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <span>{complex ? complex.name : '–û–±\'—î–∫—Ç –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</span>
                                </div>
                                
                                <div className="flex items-center justify-between pt-6 border-t border-gray-50">
                                    {statusId !== 'todo' && (
                                        <button 
                                            onClick={() => {
                                                const prevStatus = statusId === 'done' ? 'in-progress' : 'todo';
                                                updateTaskStatus(task.id, prevStatus);
                                            }}
                                            className="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center hover:bg-gray-50 text-gray-400"
                                        >
                                            ‚Üê
                                        </button>
                                    )}

                                    <div className="flex items-center gap-3">
                                        <img src={worker?.avatar || 'https://via.placeholder.com/150'} className="w-8 h-8 rounded-lg object-cover" />
                                        <div className="text-[10px] font-black text-gray-800 uppercase">{worker ? worker.name : '–ì—ñ—Å—Ç—å'}</div>
                                    </div>

                                    {statusId !== 'done' && (
                                        <button 
                                            onClick={() => {
                                                const nextStatus = statusId === 'todo' ? 'in-progress' : 'done';
                                                updateTaskStatus(task.id, nextStatus);
                                            }}
                                            className="w-8 h-8 rounded-full border border-brand-main text-brand-main flex items-center justify-center hover:bg-blue-50 font-bold"
                                        >
                                            ‚Üí
                                        </button>
                                    )}
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        ))}
    </div>
)}
{activeTab === 'complexes' && (() => {
    // 1. –ì—Ä—É–ø—É—î–º–æ –∫–æ–º–ø–ª–µ–∫—Å–∏ –∑–∞ –º—ñ—Å—Ç–æ–º
    const groupedComplexes = complexes.reduce((groups, cx) => {
        const city = cx.city ? cx.city.trim() : '–Ü–Ω—à—ñ';
        const formattedCity = city.charAt(0).toUpperCase() + city.slice(1).toLowerCase();
        if (!groups[formattedCity]) groups[formattedCity] = [];
        groups[formattedCity].push(cx);
        return groups;
    }, {});

    // 2. –°–æ—Ä—Ç—É—î–º–æ –Ω–∞–∑–≤–∏ –º—ñ—Å—Ç –∑–∞ –∞–ª—Ñ–∞–≤—ñ—Ç–æ–º
    const sortedCities = Object.keys(groupedComplexes).sort((a, b) => a.localeCompare('uk'));

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    const handleEdit = (cx) => {
        const newName = prompt("–ù–∞–∑–≤–∞ –ñ–ö:", cx.name);
        const newCity = prompt("–ú—ñ—Å—Ç–æ:", cx.city);
        const newAddr = prompt("–ê–¥—Ä–µ—Å–∞:", cx.address);
        const newHead = prompt("–ü–Ü–ë –ì–æ–ª–æ–≤–∏ –û–°–ë–ë:", cx.headName);

        if (newName && newCity) {
            const cityTrimmed = newCity.trim();
            const formattedCity = cityTrimmed.charAt(0).toUpperCase() + cityTrimmed.slice(1).toLowerCase();

            const updatedComplexes = complexes.map(item => 
                item.id === cx.id 
                ? { ...item, name: newName.trim(), city: formattedCity, address: newAddr.trim(), headName: newHead.trim() }
                : item
            );

            setComplexes(updatedComplexes);
            saveToServer({ complexes: updatedComplexes });
            addLog('–ö–æ–º–ø–ª–µ–∫—Å–∏', `–û–Ω–æ–≤–ª–µ–Ω–æ –¥–∞–Ω—ñ –æ–±'—î–∫—Ç–∞: ${newName}`);
        }
    };

    return (
        <div className="fade-in">
            {/* –®–∞–ø–∫–∞ —Å–µ–∫—Ü—ñ—ó */}
            <div className="flex justify-between items-center mb-10">
                <div>
                    <h2 className="text-3xl font-[950] text-gray-900 tracking-tight">–ë–∞–∑–∞ –æ–±'—î–∫—Ç—ñ–≤ (–ñ–ö)</h2>
                    <p className="text-gray-400 font-bold text-xs uppercase tracking-widest mt-2">–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ–∞–ª—å–Ω–∏–º–∏ –≥—Ä–æ–º–∞–¥–∞–º–∏</p>
                </div>
                <button 
                    onClick={() => {
                        const rawName = prompt("–ù–∞–∑–≤–∞ –ñ–ö:");
                        const rawCity = prompt("–ú—ñ—Å—Ç–æ:", "–ö–∏—ó–≤");
                        const addr = prompt("–ê–¥—Ä–µ—Å–∞:");
                        const head = prompt("–ü–Ü–ë –ì–æ–ª–æ–≤–∏ –û–°–ë–ë:");

                        if (rawName && rawCity) {
                            const name = rawName.trim();
                            const cityTrimmed = rawCity.trim();
                            const city = cityTrimmed.charAt(0).toUpperCase() + cityTrimmed.slice(1).toLowerCase();
                            const newCx = { id: Date.now(), name, city, address: addr?.trim() || '', headName: head?.trim() || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' };
                            const updated = [...complexes, newCx];
                            setComplexes(updated);
                            saveToServer({ complexes: updated });
                            addLog('–ö–æ–º–ø–ª–µ–∫—Å–∏', `–î–æ–¥–∞–Ω–æ –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç: ${name} (${city})`);
                        }
                    }}
                    className="bg-brand-main text-white px-8 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-blue-100 hover:scale-105 transition-all"
                >
                    + –î–æ–¥–∞—Ç–∏ –æ–±'—î–∫—Ç
                </button>
            </div>

            {complexes.length === 0 ? (
                <div className="py-20 text-center bg-gray-50 rounded-[40px] border-2 border-dashed border-gray-200">
                    <div className="text-4xl mb-4">üè¢</div>
                    <div className="text-gray-400 font-bold">–°–ø–∏—Å–æ–∫ –æ–±'—î–∫—Ç—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π</div>
                </div>
            ) : (
                sortedCities.map(city => (
                    <div key={city} className="mb-12">
                        <div className="flex items-center gap-4 mb-8">
                            <div className="bg-white border border-gray-100 px-5 py-2.5 rounded-2xl shadow-sm flex items-center gap-3">
                                <span className="text-xl">üìç</span>
                                <span className="font-[950] text-gray-800 uppercase tracking-tighter text-lg">{city}</span>
                                <span className="bg-blue-50 text-blue-600 text-[10px] px-2 py-1 rounded-lg ml-2 font-black">{groupedComplexes[city].length}</span>
                            </div>
                            <div className="h-[2px] flex-1 bg-gradient-to-r from-gray-100 to-transparent"></div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {groupedComplexes[city].map(cx => (
                                <div key={cx.id} className="bg-white p-8 rounded-[40px] shadow-sm border border-gray-100 group hover:shadow-md transition-all relative overflow-hidden">
                                    <div className="flex justify-between items-start mb-6">
                                        <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-xl shadow-inner">üè¢</div>
                                        <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-all">
                                            {/* –ö–Ω–æ–ø–∫–∞ –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø */}
                                            <button 
                                                onClick={() => handleEdit(cx)}
                                                className="w-8 h-8 rounded-xl bg-blue-50 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors"
                                                title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏"
                                            >
                                                ‚úé
                                            </button>
                                            {/* –ö–Ω–æ–ø–∫–∞ –í–ò–î–ê–õ–ï–ù–ù–Ø */}
                                            <button 
                                                onClick={() => {
                                                    if(confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ ${cx.name}?`)) {
                                                        const updated = complexes.filter(c => c.id !== cx.id);
                                                        setComplexes(updated);
                                                        saveToServer({ complexes: updated });
                                                        addLog('–ö–æ–º–ø–ª–µ–∫—Å–∏', `–í–∏–¥–∞–ª–µ–Ω–æ –æ–±'—î–∫—Ç: ${cx.name}`);
                                                    }
                                                }}
                                                className="w-8 h-8 rounded-xl bg-red-50 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-colors"
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <h3 className="font-[950] text-gray-900 text-xl mb-1 leading-tight">{cx.name}</h3>
                                    <p className="text-gray-400 font-bold text-[10px] uppercase tracking-wider mb-5 flex items-center gap-2">
                                        <span className="w-1 h-1 bg-gray-300 rounded-full"></span>
                                        {cx.address || '–ê–¥—Ä–µ—Å–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞'}
                                    </p>
                                    
                                    <div className="flex items-center gap-3 bg-gray-50 p-4 rounded-3xl mb-2 border border-gray-50 group-hover:bg-blue-50/50 group-hover:border-blue-100 transition-colors">
                                        <div className="w-9 h-9 bg-white rounded-xl flex items-center justify-center shadow-sm text-sm">üë§</div>
                                        <div>
                                            <p className="text-[8px] font-black text-gray-400 uppercase tracking-widest leading-none mb-1">–ì–æ–ª–æ–≤–∞ –û–°–ë–ë</p>
                                            <p className="text-xs font-black text-gray-800">{cx.headName}</p>
                                        </div>
                                    </div>

                                    <div className="mt-6 pt-6 border-t border-gray-50 flex justify-between items-center text-[10px] font-black uppercase tracking-widest">
                                        <span className="text-gray-300">ID: {cx.id.toString().slice(-5)}</span>
                                        <div className="flex items-center gap-1.5 bg-green-50 text-green-600 px-3 py-1.5 rounded-full">
                                            <div className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                                            <span>–ê–∫—Ç–∏–≤–Ω–∏–π</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                ))
            )}
        </div>
    );
})()}
{activeTab === 'inventory' && <InventoryView inventory={inventory} setInventory={setInventory} addLog={addLog} />}
                            
           {activeTab === 'staff' && (
                                <StaffView 
                                    users={users} 
                                    shifts={shifts} 
                                    logs={logs} 
                                    createUser={createUser} 
                                    deleteUser={deleteUser}
                                    onUpdateProfile={updateProfile}
                                    currentUser={currentUser}
                                    deleteShift={deleteShift} 
                                    editShift={editShift}
                                />
                            )}

               {activeTab === 'profile' && (
    <div className="max-w-2xl mx-auto fade-in">
        <div className="bg-white rounded-[40px] shadow-sm border border-gray-100 overflow-hidden">
            <div className="h-32 bg-brand-main/10 relative"></div>
            <div className="px-10 pb-10 relative">
                <div className="flex justify-between items-end -mt-16 mb-8">
                  <div className="relative group">
    <img 
        src={currentUser.avatar || 'https://via.placeholder.com/150'} 
        className="w-32 h-32 rounded-[40px] border-8 border-white object-cover shadow-lg"
        id="profile-avatar-preview"
    />
    <label className="absolute bottom-2 right-2 bg-white w-10 h-10 rounded-2xl shadow-xl flex items-center justify-center cursor-pointer hover:bg-brand-main hover:text-white transition-all border border-gray-100">
        üì∑
    <input 
    type="file" 
    accept="image/*" 
    className="hidden" 
  onChange={(e) => {
    const file = e.target.files[0];
    if (file) {
        // –î–æ–¥–∞–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è, —â–æ–± —Ñ–∞–π–ª –Ω–µ –±—É–≤ –∑–∞–Ω–∞–¥—Ç–æ –≤–∞–∂–∫–∏–º –¥–ª—è JSON
        if (file.size > 1024 * 1024) { 
            alert("–§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π! –û–±–µ—Ä—ñ—Ç—å —Ñ–æ—Ç–æ –¥–æ 1 –ú–ë.");
            return;
        }

        const reader = new FileReader();
        reader.onloadend = () => {
            const base64String = reader.result;

            // 1. –û—Ç—Ä–∏–º—É—î–º–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Å–µ—Å—ñ—ó, —è–∫—â–æ —Å—Ç–µ–π—Ç currentUser –∑–±–æ—ó—Ç—å
            const session = JSON.parse(localStorage.getItem(SESSION_KEY));
            const currentId = currentUser?.id || session?.user?.id;

            if (!currentId) {
                alert("–ü–æ–º–∏–ª–∫–∞: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π");
                return;
            }

            const updatedUser = { ...currentUser, avatar: base64String };

            // 2. –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–µ–π—Ç –ø–æ—Ç–æ—á–Ω–æ–≥–æ —é–∑–µ—Ä–∞ (–¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ)
            setCurrentUser(updatedUser);

            // 3. –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Å–∏–≤ —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—Ü–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Å —É users.json)
            setUsers(prevUsers => {
                const newUsers = prevUsers.map(u => u.id === currentId ? updatedUser : u);
                console.log("–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–æ, –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è...");
                return newUsers;
            });
        };
        reader.readAsDataURL(file);
    }
}}
/>
    </label>
</div>
                  
                    <button onClick={() => setActiveTab('staff')}
                        className="bg-brand-main text-white px-8 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:scale-105 transition-all shadow-xl shadow-blue-100">
                        –ö–æ–º–∞–Ω–¥–∞
                    </button>
                </div>

                <div className="space-y-6">
                    <div>
                        <h2 className="text-3xl font-[950] text-gray-900 tracking-tight">{currentUser.name}</h2>
                        <span className="inline-block mt-2 px-4 py-1.5 bg-brand-main/10 text-brand-main rounded-xl text-[10px] font-black uppercase tracking-widest">
                            {currentUser.role}
                        </span>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-gray-50 p-6 rounded-3xl">
                            <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Email</p>
                            <p className="font-bold text-gray-800">{currentUser.email}</p>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-3xl">
                            <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">–¢–µ–ª–µ—Ñ–æ–Ω</p>
                            <p className="font-bold text-gray-800">{currentUser.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</p>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-3xl">
                            <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">–î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</p>
                            <p className="font-bold text-gray-800">
                                {currentUser.birthday ? new Date(currentUser.birthday).toLocaleDateString('uk-UA') : '‚Äî'}
                            </p>
                        </div>
                    </div>

                    <div className="pt-6 border-t border-gray-50 grid grid-cols-1 gap-3">
                        <h4 className="font-black text-[10px] uppercase tracking-widest text-gray-400">–ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –¥–∞–Ω—ñ</h4>
                        
                        <button 
                            onClick={() => {
                                const newPass = prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å:");
                                if (newPass) {
                                    onUpdateProfile({ ...currentUser, password: newPass });
                                    alert("–ü–∞—Ä–æ–ª—å –∑–º—ñ–Ω–µ–Ω–æ!");
                                }
                            }}
                            className="w-full py-4 rounded-2xl border-2 border-gray-100 text-gray-600 font-bold hover:bg-gray-50 transition-all flex items-center justify-center gap-2"
                        >
                            üîí –ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
)}
                            {activeTab === 'archive' && (
                                <div className="bg-white rounded-[40px] shadow-sm border border-gray-100 overflow-hidden fade-in">
                                    <div className="p-8 border-b border-gray-50"><h3 className="text-xl font-black uppercase tracking-tight">–ê—Ä—Ö—ñ–≤</h3></div>
                                    <div className="divide-y divide-gray-50">
                                        {archiveTasks.map(task => (
                                            <div key={task.id} className="p-6 flex items-center justify-between hover:bg-gray-50">
                                                <div>
                                                    <div className="font-bold text-gray-800">{task.title}</div>
                                                    <div className="text-[10px] text-gray-400 uppercase font-black">–ó–∞–≤–µ—Ä—à–µ–Ω–æ: {new Date(task.archivedAt).toLocaleDateString()}</div>
                                                </div>
                                                <button onClick={() => deleteTask(task.id, true)} className="text-red-400 hover:text-red-600 font-black text-xs uppercase">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
{showShiftModal && (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div className="absolute inset-0 bg-brand-dark/60 backdrop-blur-sm" onClick={() => { setShowShiftModal(false); setEditingShift(null); }}></div>
        <div className="bg-white w-full max-w-md rounded-[35px] shadow-2xl relative overflow-hidden fade-in">
            <div className="p-8">
                <h3 className="text-xl font-[1000] uppercase italic tracking-tight mb-6">
                    {editingShift ? 'üìù –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–º—ñ–Ω—É' : '‚ú® –ù–æ–≤–∞ –∑–º—ñ–Ω–∞'}
                </h3>
                
                {/* –ü–µ—Ä–µ–º–∏–∫–∞—á —Ä–µ–∂–∏–º—ñ–≤ */}
                <div className="flex bg-gray-100 p-1 rounded-2xl mb-6">
                    <button 
                        type="button"
                        onClick={() => setShiftMode('single')}
                        className={`flex-1 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${shiftMode === 'single' ? 'bg-white shadow-sm text-brand-main' : 'text-gray-400'}`}>
                        –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –¥–∞—Ç–∞
                    </button>
                    <button 
                        type="button"
                        onClick={() => setShiftMode('recurring')}
                        className={`flex-1 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${shiftMode === 'recurring' ? 'bg-white shadow-sm text-brand-main' : 'text-gray-400'}`}>
                        –ì—Ä–∞—Ñ—ñ–∫ (–ü–Ω-–ü—Ç)
                    </button>
                </div>

                <form onSubmit={(e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    
                    const shiftData = {
                        id: editingShift ? editingShift.id : Date.now(),
                        userId: Number(formData.get('userId')),
                        type: formData.get('type'),
                        isRecurring: shiftMode === 'recurring',
                        // –î–∞–Ω—ñ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫–∞
                        daysRange: formData.get('daysRange'),
                        timeRange: formData.get('timeRange'),
                        // –î–∞–Ω—ñ –¥–ª—è –¥–∞—Ç–∏
                        start: formData.get('start'),
                        end: formData.get('end'),
                    };

                    if (editingShift) {
                        setShifts(shifts.map(s => s.id === editingShift.id ? shiftData : s));
                    } else {
                        setShifts([...shifts, shiftData]);
                    }
                    
                    setShowShiftModal(false);
                    setEditingShift(null);
                }} className="space-y-4">
                    
                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</label>
                        <select name="userId" defaultValue={editingShift?.userId || ""} className="w-full border-2 border-gray-100 p-4 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold" required>
                            <option value="" disabled>–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞...</option>
                            {users.map(u => <option key={u.id} value={u.id}>{u.name} ({u.role})</option>)}
                        </select>
                    </div>

                    {shiftMode === 'single' ? (
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–ü–æ—á–∞—Ç–æ–∫</label>
                                <input type="datetime-local" name="start" defaultValue={editingShift?.start} className="w-full border-2 border-gray-100 p-4 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold text-[10px]" required />
                            </div>
                            <div>
                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–ö—ñ–Ω–µ—Ü—å</label>
                                <input type="datetime-local" name="end" defaultValue={editingShift?.end} className="w-full border-2 border-gray-100 p-4 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold text-[10px]" required />
                            </div>
                        </div>
                    ) : (
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–î–Ω—ñ (–Ω–∞–ø—Ä. –ü–Ω-–ü—Ç)</label>
                                <input type="text" name="daysRange" defaultValue={editingShift?.daysRange || "–ü–Ω-–ü—Ç"} placeholder="–ü–Ω-–ü—Ç" className="w-full border-2 border-gray-100 p-4 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold text-[11px]" required />
                            </div>
                            <div>
                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–ß–∞—Å (–Ω–∞–ø—Ä. 8-16)</label>
                                <input type="text" name="timeRange" defaultValue={editingShift?.timeRange || "08:00 - 16:00"} placeholder="08:00 - 16:00" className="w-full border-2 border-gray-100 p-4 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold text-[11px]" required />
                            </div>
                        </div>
                    )}

                    <div>
                        <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–¢–∏–ø –∑–º—ñ–Ω–∏</label>
                        <select name="type" defaultValue={editingShift?.type || "day"} className="w-full border-2 border-gray-100 p-4 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold" required>
                            <option value="day">‚òÄÔ∏è –î–µ–Ω–Ω–∞</option>
                            <option value="night">üåô –ù—ñ—á–Ω–∞</option>
                        </select>
                    </div>

                    <div className="flex gap-3 pt-4">
                        <button type="button" onClick={() => { setShowShiftModal(false); setEditingShift(null); }} className="flex-1 bg-gray-100 text-gray-500 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button type="submit" className="flex-1 bg-brand-main text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg hover:shadow-brand-main/20 transition-all">
                            {editingShift ? '–ó–±–µ—Ä–µ–≥—Ç–∏' : '–°—Ç–≤–æ—Ä–∏—Ç–∏'}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
)}
{showModal && (
                        <div className="fixed inset-0 bg-brand-dark/80 backdrop-blur-xl flex items-center justify-center z-[100] p-6">
                            <div className="bg-white rounded-[50px] w-full max-w-2xl shadow-2xl fade-in overflow-hidden">
                                <div className="p-12">
                                    <div className="flex justify-between items-center mb-10">
                                        <h2 className="text-3xl font-[950] text-gray-900 tracking-tight uppercase">–ù–æ–≤–∞ –ó–∞—è–≤–∫–∞</h2>
                                        <button onClick={() => setShowModal(false)} className="w-12 h-12 bg-gray-50 rounded-2xl flex items-center justify-center text-gray-400 hover:text-gray-900 text-xl font-bold transition-all">‚úï</button>
                                    </div>
                                    
                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        const fd = new FormData(e.target);
                                        const nt = {
                                            id: Date.now(),
                                            title: fd.get('t'),
                                            priority: fd.get('p'),
                                            locationId: Number(fd.get('l')),
                                            assignee: Number(fd.get('a')), 
                                            status: 'todo',
                                            createdAt: new Date().toISOString()
                                        };
                                        setTasks(prev => [...prev, nt]);
                                        addLog("–ó–∞—è–≤–∫–∞", `–°—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞–¥–∞—á—É: ${nt.title.slice(0, 30)}...`);
                                        setShowModal(false);
                                    }} className="space-y-6">
                                        
                                        <div>
                                            <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–û–ø–∏—Å</label>
                                            <textarea name="t" className="w-full border-2 border-gray-100 p-6 rounded-[30px] mt-2 outline-none focus:border-brand-main transition-all font-bold h-32 resize-none bg-gray-50 focus:bg-white" required />
                                        </div>

                                        <div className="grid grid-cols-2 gap-6">
                                            <div>
                                                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</label>
                                                <select name="p" className="w-full border-2 border-gray-100 p-5 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold">
                                                    <option value="–ù–∏–∑—å–∫–∏–π">–ù–∏–∑—å–∫–∏–π</option>
                                                    <option value="–°–µ—Ä–µ–¥–Ω—ñ–π">–°–µ—Ä–µ–¥–Ω—ñ–π</option>
                                                    <option value="–í–∏—Å–æ–∫–∏–π">–í–∏—Å–æ–∫–∏–π</option>
                                                    <option value="–ö—Ä–∏—Ç–∏—á–Ω–∏–π">–ö—Ä–∏—Ç–∏—á–Ω–∏–π</option>
                                                </select>
                                            </div>
                                          <div>
                                            <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–û–±'—î–∫—Ç (–ñ–ö)</label>
                                            <select name="l" className="w-full border-2 border-gray-100 p-5 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold" required>
                                                <option value="">–û–±–µ—Ä—ñ—Ç—å –ñ–ö...</option>
                                                {[...complexes]
                                                    .sort((a, b) => a.name.localeCompare(b.name, 'uk'))
                                                    .map(cx => (
                                                        <option key={cx.id} value={cx.id}>{cx.name}</option>
                                                    ))
                                                }
                                            </select>
                                        </div>
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π</label>
                                            <select name="a" className="w-full border-2 border-gray-100 p-5 rounded-2xl mt-2 outline-none focus:border-brand-main bg-gray-50 font-bold">
                                                {users.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                                            </select>
                                        </div>

                                        <button type="submit" className="w-full bg-brand-main text-white py-5 rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl hover:bg-blue-600 transition-all">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>